// Declarative.
pipeline {
  agent any

  options {
    skipDefaultCheckout()
  }

  stages {
    stage('Code checkout') {
      steps {
        checkout scm
        sh ' ls -ltra '
      }
    }

    stage('Python version') {
      steps {
        sh ' python --version '
      }
    }

    stage('Setup') {
      steps {
        dir('01-jenkins-basics') {
          sh '''
            echo 'Create Python virtual environment. '
            python -m venv venv
            echo 'Upgrade pip module. '
            ./venv/bin/python -m pip install --upgrade pip
            echo 'Install project dependencies. '
            ./venv/bin/python -m pip install -r requirements.txt
          '''
        }
      }
    }

    stage('Unit testing') {
      steps {
        dir('01-jenkins-basics') {
          sh ' ./venv/bin/python -m pytest -vvv '
        }
      }
    }
  }
}